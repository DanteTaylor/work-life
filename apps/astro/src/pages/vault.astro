---
async function getFiles() {
  const r = await fetch('http://localhost:4321/api/obsidian/vault');
  const data = await r.json().catch(async () => { throw new Error(await r.text()); });

  return Array.isArray(data) ? data
       : Array.isArray(data?.files) ? data.files
       : Array.isArray(data?.children) ? data.children
       : [];
}

let files = [];
try {
  files = await getFiles();
} catch (e) {
  files = [{ basename: `Error: ${String(e).slice(0,160)}` }];
}
---

<head><meta charset="utf-8" /></head>

<h1>Vault Files</h1>

<ul>
  {Array.isArray(files)
    ? files.map(f => (
        <li>{f.basename ?? f.name ?? f.path ?? String(f)}</li>
      ))
    : <li>⚠️ No files found or data not in list format.</li>}
</ul>

<pre style="background:#f9f9f9;padding:1rem;">
  {JSON.stringify(files, null, 2)}
</pre>
